name: Recent Activity

on:
  schedule:
    - cron: "*/30 * * * *"   # 30 dakikada bir
  workflow_dispatch:

jobs:
  activity:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate Recent Activity
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require("fs");

            const res = await github.rest.activity.listPublicEventsForUser({
              username: "CBYeuler",
              per_page: 20,
            });

            const events = res.data;

            const lines = events
              .filter(e => e.type === "PushEvent")
              .map(e => {
                const repo = e.repo?.name ?? "Unknown Repo";

                const commits = e.payload?.commits;
                if (!commits || commits.length === 0)
                  return null;

                const msg = commits[0].message ?? "(no message)";
                return `- [${repo}]: ${msg}`;
              })
              .filter(Boolean)
              .slice(0, 10)   // ilk 10 tanesi
              .join("\n");

            fs.writeFileSync("RECENT.md", lines || "No recent pushes.");
      
      - name: Commit file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: RECENT.md
          commit_message: "update: recent activity"

